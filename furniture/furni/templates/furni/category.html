{% extends 'main.html' %}
{% load humanize %}
{% block content %}
<!-- Category Tabs -->
 


  {% if products %}
<!-- Filters & Sort -->
<div class="container py-4">
  <div class="breadcrumbs">
  <ul class="breadcrumb">
  <li><a href="{% url 'home' %}">Home</a></li>
  <li><a href="{{request.path}}">{{present_room}}</a></li>
</ul>
</div>
  <div class="d-flex justify-content-between align-items-center mb-4">
    
    
    <!-- Filter Icon -->
    <button class="btn btn-outline-dark btn-sm d-flex align-items-center" 
            type="button" data-bs-toggle="offcanvas" data-bs-target="#filterOffcanvas">
      <i class="bi bi-funnel me-1"></i> Filters
    </button>

    <!-- Sort Dropdown -->
    <div class="d-flex align-items-center gap-2">
      <select class="form-select form-select-sm" id="sort_order" style="width: 150px;">
        <option value="">Recommended</option>
        <option value="low_to_high">Price: Low to High</option>
        <option value="high_to_low">Price: High to Low</option>
      </select>
    </div>
  </div>

  <div id="product-list" class="row g-4"> {% include "furni/product_list.html" with products=products %} </div>

</div>
{% else %}
<div class="col-12" style="
    text-align: center;
    display: flex;
    font-size: medium;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    height: 500px;"><p>Sorry, no products matched the keyword</p></div>
  {% endif %}

<!-- Offcanvas Filter Sidebar -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="filterOffcanvas">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">Filters</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <!-- Price Filter -->
    <label class="form-label fw-bold">Price Range</label>
    <select id="price_filter" class="form-select form-select-sm mb-3">
      <option hidden value="" disabled selected>Select Price</option>
      <option value="">All Prices</option>
      <option value="5000-19999">5000-19999</option>
      <option value="20000-29999">20000-29999</option>
      <option value="30000-39999">30000-39999</option>
      <option value="40000-49999">40000-49999</option>
      <option value="50000-59999">50000-59999</option>
    </select>

    <!-- Future filters -->
    <!--
    <label class="form-label fw-bold">Brand</label>
    <select class="form-select form-select-sm mb-3"><option>All Brands</option></select>
    
    <label class="form-label fw-bold">Material</label>
    <select class="form-select form-select-sm mb-3"><option>All Materials</option></select>
    -->
    
    <!-- Apply button -->
    <button class="btn btn-dark w-100 mt-3" onclick="getFilteredProducts()">Apply Filters</button>
  </div>
</div>
<script>

  function getFilterUrl() {
    const base = window.location.pathname;
    const price = document.getElementById("price_filter").value;
    const sort = document.getElementById('sort_order').value;
    let search = "{{search_word}}"
    const params = new URLSearchParams();
    if (price) params.append("price", price);
    if (sort) params.append("sort", sort);
    if (search) params.append("search_word", search);
    console.log(base + "?" + params.toString());
    return base + "?" + params.toString();
  }

  function getFilteredProducts() {
    const url = getFilterUrl();
    let search_word = document.getElementById("product-search-input").value
    fetch(url, {
      headers: {
        "X-Requested-With": "XMLHttpRequest"
      }
    })
      .then(response => response.text())
      .then(html => {
        document.getElementById("product-list").innerHTML = html;
      })
  }

  
  document.getElementById("sort_order").addEventListener("change", getFilteredProducts)


</script>

{% endblock content %}