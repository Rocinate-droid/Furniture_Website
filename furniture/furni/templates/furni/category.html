{% extends 'main.html' %}
{% load humanize %}
{% block content %}
<!-- Category Tabs -->
<div class="bg-light py-2 border-bottom">
  <div class="container d-flex justify-content-between">
    <div>
      <p>{{category.name}}</p>
    </div>
    <div>
      <a href="#" class="mx-2 text-dark text-decoration-none">1 Seater Sofa</a>
      <a href="#" class="mx-2 text-dark text-decoration-none">2 Seater Sofa</a>
      <a href="#" class="mx-2 text-dark text-decoration-none">3 Seater Sofa</a>
      <a href="#" class="mx-2 text-dark text-decoration-none">Sofa Set</a>
    </div>
  </div>
</div>

<!-- Filters & Sort -->
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div class="d-flex flex-wrap gap-2">
      <select id="price_filter" class="form-select form-select-sm" style="width: 150px;">
        <option hidden value="" disabled selected>Price Range</option>
        <option value="">All Prices</option>
        <option value="5000-19999">5000-19999</option>
        <option value="20000-29999">20000-29999</option>
        <option value="30000-39999">30000-39999</option>
        <option value="40000-49999">40000-49999</option>
        <option value="50000-59999">50000-59999</option>
      </select>

      <!--<select class="form-select form-select-sm" style="width: 150px;"><option>Brand</option></select>
      <select class="form-select form-select-sm" style="width: 150px;"><option>Material</option></select>
      <select class="form-select form-select-sm" style="width: 150px;"><option>Upholstery</option></select>
      <select class="form-select form-select-sm" style="width: 150px;"><option>Design</option></select>
    -->
    </div>
    <div class="d-flex align-items-center gap-2">
      <select class="form-select form-select-sm" id="sort_order" style="width: 150px;">
        <option value="">Recommended</option>
        <option value="low_to_high">Price: Low to High</option>
        <option value="high_to_low">Price: High to Low</option>
      </select>
    </div>
  </div>

  <!-- Product Grid -->
  <div id="product-list" class="row g-4">
    {% include "furni/product_list.html" with products=products %}
  </div>
</div>
<script>

  function getFilterUrl() {
    const base = window.location.pathname;
    const price = document.getElementById("price_filter").value;
    const sort = document.getElementById('sort_order').value;
    const params = new URLSearchParams();
    if (price) params.append("price", price);
    if (sort) params.append("sort", sort);

    return base + "?" + params.toString();
  }

  function getFilteredProducts() {
    const url = getFilterUrl();
    fetch(url, {
      headers: {
        "X-Requested-With": "XMLHttpRequest"
      }
    })
      .then(response => response.text())
      .then(html => {
        document.getElementById("product-list").innerHTML = html;
      })
  }

  document.getElementById("price_filter").addEventListener("change", getFilteredProducts)
  document.getElementById("sort_order").addEventListener("change", getFilteredProducts)


</script>

{% endblock content %}