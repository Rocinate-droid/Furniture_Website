{% load static %}
{% load humanize %}
{% load mathfilters %}
<style>
  @media screen and (max-width:767px) {
    .breadcrumbs-mobile-only {
      display:flex;
    }
    .breadcrumbs-desktop-only {
      display: none;
    }
    
  }

  @media screen and (min-width:767px) {
    .breadcrumbs-mobile-only {
      display:none;
    }
    .breadcrumbs-desktop-only {
      display: flex;
    }
  }
  ul.breadcrumb {
    margin-bottom: 20px;
  list-style: none;
  background-color: transparent;
}

/* Display list items side by side */
ul.breadcrumb li {
  display: inline;
  font-size: px;
}

/* Add a slash symbol (/) before/behind each list item */
ul.breadcrumb li+li:before {
  padding: 8px;
  color: black;
  content: "/\00a0";
}

/* Add a color to all links inside the list */
ul.breadcrumb li a {
  color: #0275d8;
  text-decoration: none;
}

 

/* Add a color on mouse-over */
ul.breadcrumb li a:hover {
  color: #01447e;
  text-decoration: underline;
}
  .top-banner{
    height: 22px;
  }
  @media screen and (max-width:647px) {
    .top-banner-text {
      font-size:small;
    }
  }
  @media screen and (max-width:592px) {
    .top-banner-text {
      font-size:x-small;
    }
  }
  @media screen and (max-width:430px) {
    .top-banner-text {
      font-size:xx-small;
    }
  }
  .module-logo {
    height: 140px;
    width: 140px;
  }
  @media screen and (max-width:764px) {
    .module-logo {
      height: 30px;
      width: 100px;
    }
    .navbar-brand {
      margin-right: auto;
    }
    .navbar-toggler {
      padding-left: 0px;
    }
  }
 

   button.btn.btn-sm.btn-light {
    background-color: #E5D9D9;
    color: black;
}
a.nav-link {
  color: black;
  text-decoration: none;
}
.navbar-dark .navbar-toggler-icon {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(0, 0, 0, 0.55)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
}

/* Add a color to the active/current link */
.cart-items-body {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .cart-image {
    max-width: 70px;
    height: 70px;
    display: flex;
  }
  .cart-item {
    align-self: flex-start;
  }
  .cart-item-delete {
    align-self: flex-start;
    margin-left: auto;
  }
  .cart-price-details {
    display: flex;
    flex: auto;
  }
 .offcanvas-body {
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* ðŸŸ© Hide scrollbar but keep scroll functionality */
#quick-cart-list {
  overflow-y: auto;
  max-height: calc(100vh - 500px);  /* keep as before */
  padding-right: 6px;

  /* Hide scrollbar */
  scrollbar-width: none;       /* Firefox */
  -ms-overflow-style: none;    /* IE & Edge */
}

#quick-cart-list::-webkit-scrollbar {
  display: none;               /* Chrome, Safari */
}





  
</style>
<!--
 <div class="top-banner">
    <p class="top-banner-text" style="text-align: center; color: black;">Currently servicing only in <span style="color: red;">Thrissur, Ernakulam and Alapuzha,</span> Coming soon to all of Kerala</h2>
  </div>
-->
		<!-- Start Header/Navigation -->
    
<nav class="navbar navbar-expand-md navbar-dark py-1" style="background-color: #E5D9D9;">

  <div class="container">

    <!-- Logo -->
    <!-- Toggler -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar" aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="{% url 'home' %}">
    <picture>
      <source media="(max-width:764px)" srcset="{% static 'images/mini-logo.png' %}">
      
      <img src="{% static 'images/module-logo.png' %}" alt="Logo" class="module-logo">

      </picture>
          </a>
    
            <div class="d-flex align-items-center gap-3 ms-md-3 my-2 my-md-0 py-1 mobile-navbar-links">
 
<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mobileSearch" aria-controls="mobileSearch" aria-expanded="false" aria-label="Toggle navigation" style="padding: 0;">
      <span class="fa fa-search text-dark"></span>
    </button>
  <!-- Wishlist Icon -->
  <a class="fa fa-heart fs-5 text-dark" href="{% url 'wishlist' %}" style="text-decoration: none;"></a>

  <!-- Cart Icon -->


  <button class="fa fa-shopping-cart fs-5 text-dark" 
            type="button" data-bs-toggle="offcanvas" data-bs-target="#cartOffcanvas" style="background-color: transparent; border: none;">
    </button>
  <!-- User Dropdown or Login Icon -->
  
</div>
    
    <div class="d-flex flex-column flex-md-row align-items-md-center w-100 py-1 desktop-navbar-links">
      <div class="flex-grow-1 my-2 my-md-0 px-md-3">
          <div class="position-relative">
            <form action="{% url 'search' %}" method="get">
            <input id="product-search-input" name="search_word" type="text" class="form-control rounded-pill ps-4 pe-5" placeholder="Dining Table" required value="{{search_word}}">
            <span class="position-absolute top-50 end-0 translate-middle-y me-3 text-muted">
              <button type="submit" style="border: none; background-color: transparent;">
              <i class="fas fa-search"></i>
              </button>
            </span>
            </form>
          </div>
        </div>
        <div class="d-flex align-items-center gap-3 ms-md-3 my-2 my-md-0 py-1">
  <!-- Track Order Button -->

  <!-- Wishlist Icon -->
  <a class="fa fa-heart fs-5 text-dark" href="{% url 'wishlist' %}" style="text-decoration: none;"></a>

  <!-- Cart Icon -->


  <button class="fa fa-shopping-cart fs-5 text-dark" 
            type="button" data-bs-toggle="offcanvas" data-bs-target="#cartOffcanvas" style="background-color: transparent; border: none;">
    </button>
  <!-- User Dropdown or Login Icon -->
  {% if user.is_authenticated %}
  <div class="dropdown">
    <a class="fa fa-user-alt fs-5 text-dark dropdown-toggle" href="#" id="profileDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="text-decoration: none;"></a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
      <li><h6 class="dropdown-header">{{ user.first_name }}</h6></li>
      <li><a class="dropdown-item" href="{% url 'profile' %}">
        <i class="fa-solid fa-user me-2"></i> Profile
      </a></li>
      <li><a class="dropdown-item" href="{% url 'orders' %}">
        <i class="fa-solid fa-truck me-2"></i> Orders
      </a></li>
      <li><a class="dropdown-item" href="{% url 'logoutpage' %}">
        <i class="fas fa-sign-out-alt me-2"></i> Log out
      </a></li>
    </ul>
  </div>
  {% else %}
  <a class="fa fa-sign-in-alt fs-5 text-dark" href="{% url 'profile' %}" style="text-decoration: none;"></a>
  {% endif %}
</div>

    </div>

    <div class="collapse navbar-collapse" id="mobileSearch">

      <!-- First row -->
       <hr style="border: none; border-top: 2px dashed #555; margin: 10px 0;">
      <!-- Search (mobile only) -->
       <div class="flex-grow-1 my-2 my-md-0 px-md-3">
          <div class="position-relative">
            <form action="{% url 'search' %}" method="get">
            <input id="product-search-input" name="search_word" type="text" class="form-control rounded-pill ps-4 pe-5" placeholder="Dining Table" required value="{{search_word}}">
            <span class="position-absolute top-50 end-0 translate-middle-y me-3 text-muted">
              <button type="submit" style="border: none; background-color: transparent;">
              <i class="fas fa-search"></i>
              </button>
            </span>
            </form>
          </div>
        </div>

    </div>
    <!-- Collapse (first row + categories for mobile) -->
    <div class="collapse navbar-collapse" id="mainNavbar">

      <!-- First row -->
<hr style="border: none; border-top: 2px dashed #555; margin: 10px 0;">
      <!-- Categories (mobile only) -->
      <ul class="nav nav-pills flex-column d-md-none p-2" style="background-color: #E5D9D9;">
      {% for room in rooms %}
<li class="nav-item"><a class="nav-link {% if request.resolver_match.kwargs.room_type|default:0 == room.slug %}active{% endif %}" href="{% url 'rooms' room_type=room.slug %}">{{room.name}}</a></li>
      {% endfor %}
      
      </ul>

    </div>
  </div>
  
</nav>

<hr style="border: none; border-top: 2px dashed #555; margin: 0px 0;">
<!-- Categories (desktop only) -->
<div class="d-none d-md-block py-1" style="background-color: #E5D9D9;">
  <div class="container">
    <div class="room-nav-wrapper position-relative">
      <ul class="nav nav-pills justify-content-center room-nav" id="room-nav">
  {% for room in rooms %}
    <li class="nav-item position-static">
      <a data-room="{{ room.slug }}" class="nav-link {% if request.resolver_match.kwargs.room_type|default:0 == room.slug %}active{% endif %}"
         href="{% url 'rooms' room_type=room.slug %}">
        {{ room.name }}
      </a>

      <div class="room-dropdown">
        <div class="main-product-list">
          <ul class="main-prod-list"></ul>
        </div>
        <div class="sub-product-list">
          <ul class="sub-prod-list"></ul>
        </div>
        <div class="main-product-image">
          <img src="{% static 'images/store-3.jpg' %}" alt="Room image">
        </div>
        <div class="popular-categories">
          <ul id="popular-cats">
            <p>Explore Popular Categories</p>
            <li><a href="">Queen Size Beds</a></li>
            <li><a href="">King Size Beds</a></li>
            <li><a href="">Coffee Tables</li></a>
            <li><a href="">Dining Sets</li></a>
            <li><a href="">Recliners</li></a>
            <li><a href="">Sofa Cum Beds</li></a>
          </ul>
        </div>
      </div>
    </li>
  {% endfor %}
</ul>

    </div>
  </div>
</div>


<script>

document.addEventListener("DOMContentLoaded", function () {
  const roomSubItems = {
    "living-room": {
      Sofas: ["1 Seater Sofa", "2 Seater Sofa", "3 Seater Sofa", "Sofa Sets", "L Shape Sofas"],
      Recliners: ["1 Seater Recliner", "2 Seater Recliner", "3 Seater Recliner"],
      Tables: ["Center Tables", "Side Tables"],
      Storage: ["Book Cases", "Storage Cabinets"]
    },
    "dining-room": {
      "Dining Sets": ["4 Seater Dining Sets", "6 Seater Dining Sets"],
      "Dining Tables": ["Glass Tables", "Wooden Tables"],
      "Dining Chairs": ["Upholstered Chairs", "Wooden Chairs"],
      "Dining Storages": ["Crockery Units", "Sideboards"]
    },
    "bed-room": {
      Beds: ["King Size Beds", "Queen Size Beds", "Double Size Beds", "Single Size Beds"],
      Wardrobes: ["1 Door Wardrobes", "2 Door Wardrobes", "3 Door Wardrobes"],
      "Dressing Tables": ["Dressing Tables"],
      "Bed Side Tables": ["Bed Side Tables"],
      Mattresses: ["King Size Mattress", "Queen Size Mattress"]
    }
  };

  const navLinks = document.querySelectorAll("#room-nav .nav-link");

  navLinks.forEach(link => {
    link.addEventListener("mouseenter", () => {
      const roomSlug = link.dataset.room;
      if (!roomSlug || !roomSubItems[roomSlug]) return;

      const navItem = link.closest(".nav-item");
      const dropdown = navItem.querySelector(".room-dropdown");
      const mainListEl = dropdown.querySelector(".main-prod-list");
      const subListEl = dropdown.querySelector(".sub-prod-list");


      // Render main categories
      const mainCategories = Object.keys(roomSubItems[roomSlug]);
      mainListEl.innerHTML = mainCategories
        .map(cat => `<li><a href="#" data-category="${cat}">${cat}</a></li>`)
        .join("");

      // Clear subcategories initially
      if (mainCategories.length > 0) {
    const firstCategory = mainCategories[0];
    const firstItems = roomSubItems[roomSlug][firstCategory] || [];

    subListEl.innerHTML = firstItems
      .map(item => `<li><a href="#">${item}</a></li>`)
      .join("");
  } else {
    subListEl.innerHTML = "";
  }

      // Add delegated event listener for subcategories
      mainListEl.onmouseover = function (e) {
        const target = e.target.closest("a");
        if (!target) return;

        const category = target.dataset.category;
        const items = roomSubItems[roomSlug][category] || [];

        subListEl.innerHTML = items
          .map(item => `<li><a href="#">${item}</a></li>`)
          .join("");
      };
    });
  });
});
</script>





<style>
.room-nav-wrapper {
  position: relative;
}

.nav-item {
  position: static;
}

/* Dropdown styles */
.room-dropdown {
  display: none; /* fallback for old browsers */
  position: absolute;
  top: 100%;
  left: 50%;
  width: 1200px;
  max-width: 100vw;
  background-color: white;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  z-index: 1000;
  padding: 0px;
  transform: translateX(-50%);
  display: flex;
  box-sizing: border-box;

  /* Smooth fade */
  transition: opacity 0.3s ease, visibility 0.3s ease;
  opacity: 0;
  visibility: hidden;
}

/* Show dropdown on hover */
.nav-item:hover > .room-dropdown {
  display: flex;
  opacity: 1;
  visibility: visible;
}

.main-product-list,
.sub-product-list,
.popular-categories {
  flex: 1;
  min-width: 0;
  padding: 20px;
  box-sizing: border-box;
}

.main-product-list a,
.sub-product-list  a,
#popular-cats a {
  text-decoration: none;
}

.main-product-list a:hover,
.sub-product-list a:hover,
#popular-cats a:hover {
  color: blue;
}

.sub-product-list {
  background-color: #E5D9D9;
}

.popular-categories {
  background-color: #dbf3ff96;
}

.room-dropdown img {
  width: 400px;
  height: 400px;
  object-fit: cover;
}

.room-dropdown ul {
  list-style: none;
  padding-left: 0;
  margin: 0;
}

.room-dropdown {
  /* your existing settings */
  pointer-events: auto; /* ensure the dropdown stays interactive */
}

.nav-item {
  position: relative; /* so dropdown positioning is relative */
}

/* Increase the height of the hover zone a tiny bit */
.nav-item:hover > .room-dropdown {
  visibility: visible;
  opacity: 1;
  transition-delay: 0s; /* no delay on show */
}

.nav-item .room-dropdown {
  margin-top: 5px; /* ensure slight overlap with nav item to avoid gap */
}


</style>

<div class="modal fade" id="trackOrderModal" tabindex="-1" aria-labelledby="trackOrderLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="trackOrderLabel">Track Your Order</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="trackOrderForm">
          <div class="mb-3">
            <label for="orderNo" class="form-label">Order Number</label>
            <input type="text" id="orderNo" name="orderNo" class="form-control" required>
          </div>
          <div class="mb-3">
            <label for="emailid" class="form-label">Email Address</label>
            <input type="email" id="emailid" name="email" class="form-control" required>
          </div>
          <p id="delivery" style="color: red;"></p>
          <button type="submit" class="btn btn-primary w-100">Track</button>
        </form>
      </div>
    </div>
  </div>
</div>



<div class="offcanvas offcanvas-end" tabindex="-1" id="cartOffcanvas">
  <div id="quick-cart-page">
  {% include "furni/quick-cart.html" with cart_items=cart_items %}
</div>
</div>

<script>
  function productSearch() {
      const searchform = document.getElementById("product-search");
      const searchword = document.getElementById("product-search-input");
      let word = searchword.value;
      searchform.setAttribute("action",`shop/search/${encodeURIComponent(word)}/`);
    }

document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById('trackOrderForm');
    form.addEventListener('submit', function (event) {
        event.preventDefault();
        const orderNo = document.getElementById('orderNo').value;
        const email = document.getElementById('emailid').value;
		const url = `/view_single_order/${orderNo}/${encodeURIComponent(email)}`;
        fetch(url, { method: "GET" })
            .then(response => {
                if (response.ok) {
                    window.location.href = url;
                } else {
                    document.getElementById('delivery').innerText = "The order does not exist";
                }
            })
            .catch(error => {
                document.getElementById('delivery').innerText = "An error occurred";
                console.error(error);
            });
    });
});

  function updateQuantity(button, change, item_id) {
    const input = button.parentElement.querySelector('input');
    let current = parseInt(input.value, 10);
    current += change;
    if (current < 1) current = 1; // Prevent going below 1
    input.value = current;
    cartUpdate(current, item_id)
  }
  function cartUpdate(quantity,item_id){
    const url = `/update/${item_id}/${quantity}/`
    fetch(url, {
      headers: { "X-Requested-With": "XMLHttpRequest",
      "X-Template-Type": "quick-cart"
      }
    })
      .then(response => response.text())
      .then(html => {
        document.getElementById("quick-cart-page").innerHTML = html;
      })
  }
  function deleteCartItem(item_id) {
    const url = `/remove/${item_id}/`
    fetch(url, {
      headers: { "X-Requested-With": "XMLHttpRequest",
      "X-Template-Type": "quick-cart"
      }
    })
      .then(response => response.text())
      .then(html => {
        document.getElementById("quick-cart-page").innerHTML = html;
      })
  }
</script>

		<!-- End Header/Navigation -->