{% load static %}
{% load humanize %}
{% load mathfilters %}
<style>
  @media screen and (max-width:767px) {
    .breadcrumbs-mobile-only {
      display:flex;
    }
    .breadcrumbs-desktop-only {
      display: none;
    }
    
  }

  @media screen and (min-width:767px) {
    .breadcrumbs-mobile-only {
      display:none;
    }
    .breadcrumbs-desktop-only {
      display: flex;
    }
  }
  ul.breadcrumb {
    margin-bottom: 20px;
  list-style: none;
  background-color: transparent;
}

/* Display list items side by side */
ul.breadcrumb li {
  display: inline;
  font-size: px;
}

/* Add a slash symbol (/) before/behind each list item */
ul.breadcrumb li+li:before {
  padding: 8px;
  color: black;
  content: "/\00a0";
}

/* Add a color to all links inside the list */
ul.breadcrumb li a {
  color: #0275d8;
  text-decoration: none;
}

 

/* Add a color on mouse-over */
ul.breadcrumb li a:hover {
  color: #01447e;
  text-decoration: underline;
}
  .top-banner{
    height: 22px;
  }
  @media screen and (max-width:647px) {
    .top-banner-text {
      font-size:small;
    }
  }
  @media screen and (max-width:592px) {
    .top-banner-text {
      font-size:x-small;
    }
  }
  @media screen and (max-width:430px) {
    .top-banner-text {
      font-size:xx-small;
    }
  }
  .module-logo {
    height: 140px;
    width: 140px;
  }
  @media screen and (max-width:764px) {
    .module-logo {
      height: 30px;
      width: 100px;
    }
    .navbar-brand {
      margin-right: auto;
    }
    .navbar-toggler {
      padding-left: 0px;
    }
  }
 

   button.btn.btn-sm.btn-light {
    background-color: #E5D9D9;
    color: black;
}
a.nav-link {
  color: black;
  text-decoration: none;
}
.navbar-dark .navbar-toggler-icon {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(0, 0, 0, 0.55)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
}

/* Add a color to the active/current link */
.cart-items-body {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .cart-image {
    max-width: 70px;
    height: 70px;
    display: flex;
  }
  .cart-item {
    align-self: flex-start;
  }
  .cart-item-delete {
    align-self: flex-start;
    margin-left: auto;
  }
  .cart-price-details {
    display: flex;
    flex: auto;
  }
 .offcanvas-body {
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* ðŸŸ© Hide scrollbar but keep scroll functionality */
#quick-cart-list {
  overflow-y: auto;
  max-height: calc(100vh - 500px);  /* keep as before */
  padding-right: 6px;

  /* Hide scrollbar */
  scrollbar-width: none;       /* Firefox */
  -ms-overflow-style: none;    /* IE & Edge */
}

#quick-cart-list::-webkit-scrollbar {
  display: none;               /* Chrome, Safari */
}





  
</style>
<!--
 <div class="top-banner">
    <p class="top-banner-text" style="text-align: center; color: black;">Currently servicing only in <span style="color: red;">Thrissur, Ernakulam and Alapuzha,</span> Coming soon to all of Kerala</h2>
  </div>
-->
		<!-- Start Header/Navigation -->
    
<nav class="navbar navbar-expand-md navbar-dark py-1" style="background-color: #E5D9D9;">

  <div class="container">

    <!-- Logo -->
    <!-- Toggler -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar" aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="{% url 'home' %}">
    <picture>
      <source media="(max-width:764px)" srcset="{% static 'images/mini-logo.png' %}">
      
      <img src="{% static 'images/module-logo.png' %}" alt="Logo" class="module-logo">

      </picture>
          </a>
    
            <div class="d-flex align-items-center gap-3 ms-md-3 my-2 my-md-0 py-1 mobile-navbar-links">
 
<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mobileSearch" aria-controls="mobileSearch" aria-expanded="false" aria-label="Toggle navigation" style="padding: 0;">
      <span class="fa fa-search text-dark"></span>
    </button>
  <!-- Wishlist Icon -->
  <a class="fa fa-heart fs-5 text-dark" href="{% url 'wishlist' %}" style="text-decoration: none;"></a>

  <!-- Cart Icon -->


  <button class="fa fa-shopping-cart fs-5 text-dark" 
            type="button" data-bs-toggle="offcanvas" data-bs-target="#cartOffcanvas" style="background-color: transparent; border: none;">
    </button>
  <!-- User Dropdown or Login Icon -->
  
</div>
    
    <div class="d-flex flex-column flex-md-row align-items-md-center w-100 py-1 desktop-navbar-links">
      <div class="flex-grow-1 my-2 my-md-0 px-md-3">
          <div class="position-relative">
            <form action="{% url 'search' %}" method="get">
            <input id="product-search-input" name="search_word" type="text" class="form-control rounded-pill ps-4 pe-5" placeholder="Dining Table" required value="{{search_word}}">
            <span class="position-absolute top-50 end-0 translate-middle-y me-3 text-muted">
              <button type="submit" style="border: none; background-color: transparent;">
              <i class="fas fa-search"></i>
              </button>
            </span>
            </form>
          </div>
        </div>
        <div class="d-flex align-items-center gap-3 ms-md-3 my-2 my-md-0 py-1">
  <!-- Track Order Button -->

  <!-- Wishlist Icon -->
  <a class="fa fa-heart fs-5 text-dark" href="{% url 'wishlist' %}" style="text-decoration: none;"></a>

  <!-- Cart Icon -->


  <button class="fa fa-shopping-cart fs-5 text-dark" 
            type="button" data-bs-toggle="offcanvas" data-bs-target="#cartOffcanvas" style="background-color: transparent; border: none;">
    </button>
  <!-- User Dropdown or Login Icon -->
  {% if user.is_authenticated %}
  <div class="dropdown">
    <a class="fa fa-user-alt fs-5 text-dark dropdown-toggle" href="#" id="profileDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="text-decoration: none;"></a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
      <li><h6 class="dropdown-header">{{ user.first_name }}</h6></li>
      <li><a class="dropdown-item" href="{% url 'profile' %}">
        <i class="fa-solid fa-user me-2"></i> Profile
      </a></li>
      <li><a class="dropdown-item" href="{% url 'orders' %}">
        <i class="fa-solid fa-truck me-2"></i> Orders
      </a></li>
      <li><a class="dropdown-item" href="{% url 'logoutpage' %}">
        <i class="fas fa-sign-out-alt me-2"></i> Log out
      </a></li>
    </ul>
  </div>
  {% else %}
  <a class="fa fa-sign-in-alt fs-5 text-dark" href="{% url 'profile' %}" style="text-decoration: none;"></a>
  {% endif %}
</div>

    </div>

    <div class="collapse navbar-collapse" id="mobileSearch">

      <!-- First row -->
       <hr style="border: none; border-top: 2px dashed #555; margin: 10px 0;">
      <!-- Search (mobile only) -->
       <div class="flex-grow-1 my-2 my-md-0 px-md-3">
          <div class="position-relative">
            <form action="{% url 'search' %}" method="get">
            <input id="product-search-input" name="search_word" type="text" class="form-control rounded-pill ps-4 pe-5" placeholder="Dining Table" required value="{{search_word}}">
            <span class="position-absolute top-50 end-0 translate-middle-y me-3 text-muted">
              <button type="submit" style="border: none; background-color: transparent;">
              <i class="fas fa-search"></i>
              </button>
            </span>
            </form>
          </div>
        </div>

    </div>
    <!-- Collapse (first row + categories for mobile) -->
    <div class="collapse navbar-collapse" id="mainNavbar">

      <!-- First row -->
<hr style="border: none; border-top: 2px dashed #555; margin: 10px 0;">
      <!-- Categories (mobile only) -->
      <ul class="nav nav-pills flex-column d-md-none p-2" style="background-color: #E5D9D9;">
      {% for room in rooms %}
<li class="nav-item"><a class="nav-link {% if request.resolver_match.kwargs.room_type|default:0 == room.slug %}active{% endif %}" href="{% url 'rooms' room_type=room.slug %}">{{room.name}}</a></li>
      {% endfor %}
      
      </ul>

    </div>
  </div>
  
</nav>

<hr style="border: none; border-top: 2px dashed #555; margin: 0px 0;">
<!-- Categories (desktop only) -->
<div class=" d-none d-md-block py-1"  style="background-color: #E5D9D9;"" >
  <div class="container">
    <div class="room-nav-wrapper position-relative">
    <ul class="nav nav-pills justify-content-center" id="room-nav">
      {% for room in rooms %}
     <li class="nav-item">
      <a data-room="{{ room.slug }}" class="nav-link {% if request.resolver_match.kwargs.room_type|default:0 == room.slug %}active{% endif %}" href="{% url 'rooms' room_type=room.slug %}">{{room.name}}
      </a>
      <div class="nav-dropdown">
<div class="dropdown-list">
  
  <ul class="dropdown-ul">
    <p class="product-heading"></p>
  </ul>
</div>
</div>
    </li>
    
    {% endfor %}

    </ul>
        
</div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
  const roomSubItems = {
    "living-room": {
      Sofas: ["1 Seater Sofa", "2 Seater Sofa", "3 Seater Sofa", "Sofa Sets", "L Shape Sofas"],
      Recliners: ["1 Seater Recliner", "2 Seater Recliner", "3 Seater Recliner"],
      Tables: ["Center Tables", "Side Tables"],
      Storage: ["Book Cases", "Storage Cabinets"]
    },
    "dining-room": {
      "Dining Sets": ["4 Seater Dining Sets", "6 Seater Dining Sets"],
      "Dining Tables": ["Glass Tables", "Wooden Tables"],
      "Dining Chairs": ["Upholstered Chairs", "Wooden Chairs"],
      "Dining Storages": ["Crockery Units", "Sideboards"]
    },
    "bed-room": {
      Beds: ["King Size Beds", "Queen Size Beds", "Double Size Beds", "Single Size Beds"],
      Wardrobes: ["1 Door Wardrobes", "2 Door Wardrobes", "3 Door Wardrobes"],
      "Dressing Tables": ["Dressing Tables"],
      "Bed Side Tables": ["Bed Side Tables"],
      Mattresses: ["King Size Mattress", "Queen Size Mattress"]
    },
    "home-office": {
      "Office Chairs": ["High Back", "Mid Back", "Low Back", "Visitor Chairs"],
      "Office Storage": ["Steel Locker", "Office Alimarah", "Steel Cabinet"],
      "Office Tables": ["Computer Tables", "Study Tables", "Laptop Tables"],
      "Gaming Chairs": ["Gaming Chairs"]
    },
    "plastic-chairs": {
      "Plastic Chairs": ["Plastic Chairs With Arms", "Plastic Chairs Without Arms"]
    }
  };

  const navLinks = document.querySelectorAll("#room-nav .nav-link");

  navLinks.forEach(link => {
    const navItem = link.closest(".nav-item");
    const dropdown = navItem.querySelector(".nav-dropdown");
    const list = dropdown.querySelector(".dropdown-list");

    // Combined mouseenter handler
    link.addEventListener("mouseenter", () => {
      const roomSlug = link.dataset.room;
      const roomData = roomSubItems[roomSlug];

      // Populate dropdown content
      list.innerHTML = "";
      for (const [category, subproducts] of Object.entries(roomData)) {
        const column = document.createElement("div");
        column.classList.add("dropdown-column");

        const headinglink = document.createElement("a");
        headinglink.setAttribute("href", `/shop/room/${roomSlug}/${category.toLowerCase().replace(/\s/g,'-')}/`)
        headinglink.style.textDecoration = "none";
        const heading = document.createElement("p");
        heading.textContent = category;
        heading.style.fontWeight = "bold";
        headinglink.appendChild(heading);
        column.appendChild(headinglink);

        const ul = document.createElement("ul");
        subproducts.forEach(subproduct => {
          const headinglink2 = document.createElement("a");
          headinglink2.setAttribute("href", `/shop/product/${category.toLowerCase().replace(/\s/g,'-')}/${subproduct.toLowerCase().replace(/\s/g,'-')}`);
          headinglink2.style.textDecoration = "none";
          headinglink2.textContent = subproduct;
          const li = document.createElement("li");
          li.appendChild(headinglink2);
          ul.appendChild(li);
        });
        column.appendChild(ul);
        list.appendChild(column);
      }

      // Show dropdown to measure size
      dropdown.style.display = "block";

      // Positioning & sizing logic
      const rect = navItem.getBoundingClientRect();
      const viewportWidth = window.innerWidth;

      const spaceRight = viewportWidth - rect.left;
      const spaceLeft = rect.left;

      // Use max width as 90% viewport width or available space
      const maxWidth = Math.min(viewportWidth * 0.9, spaceRight + spaceLeft);

      dropdown.style.maxWidth = maxWidth + "px";
      dropdown.style.left = "0";
      dropdown.style.transform = "none";

      const dropdownRight = rect.left + dropdown.offsetWidth;

      if (dropdownRight > viewportWidth) {
        const overflowAmount = dropdownRight - viewportWidth;
        dropdown.style.left = `calc(0px - ${overflowAmount}px)`;
      }
    });

    // Hide dropdown on mouse leave
    navItem.addEventListener("mouseleave", () => {
      dropdown.style.display = "none";
      dropdown.style.left = "0";
      dropdown.style.transform = "none";
      dropdown.style.maxWidth = "";
      list.innerHTML = ""; // clear content if you want
    });
  });
});

</script>

<style>
  .dropdown-column a:hover {
  color: #007BFF; /* example: change text color on hover */
  cursor: pointer; /* if you want it clickable */
  text-decoration: underline; /* optional */
  /* add any other styles you want */
}

/* Make sure the nav container is positioned */
.room-nav-wrapper {
  position: relative; /* dropdown will position relative to this */
}

/* Position the dropdown absolutely under the nav */
.nav-item {
  position: relative;
}

.nav-dropdown {
  position: absolute;
  top: 100%;
  left: 0;
  background: white;
  padding: 10px 15px;
  box-sizing: border-box;
  overflow-x: auto;
  white-space: nowrap;
  display: none;
  z-index: 10;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}




/* Show dropdown on hover */
.nav-item:hover .nav-dropdown {
  display: block;
}

/* Flex container for columns */
.dropdown-list {
  display: flex;
  justify-content: flex-start; /* align left inside dropdown */
  flex-wrap: nowrap;
  overflow-x: auto;
  width: max-content; /* size to content */
  box-sizing: border-box;
}



/* Each column takes equal space */
.dropdown-column {
  flex: 0 0 auto; /* no grow/shrink */
  min-width: 150px; /* optional minimum width */
  padding: 0 10px;
  box-sizing: border-box;
}

.nav-dropdown {
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  border-radius: 4px;
}



/* Heading styles */
.dropdown-column h4 {
  font-weight: bold;
  margin-bottom: 10px;
}

/* List styles */
.dropdown-column ul {
  list-style: none;
  padding-left: 0;
}

.dropdown-column ul li {
  margin-bottom: 6px;
  cursor: pointer;
  white-space: nowrap; /* prevent subproduct names from breaking */
}



</style>





<div class="modal fade" id="trackOrderModal" tabindex="-1" aria-labelledby="trackOrderLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="trackOrderLabel">Track Your Order</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="trackOrderForm">
          <div class="mb-3">
            <label for="orderNo" class="form-label">Order Number</label>
            <input type="text" id="orderNo" name="orderNo" class="form-control" required>
          </div>
          <div class="mb-3">
            <label for="emailid" class="form-label">Email Address</label>
            <input type="email" id="emailid" name="email" class="form-control" required>
          </div>
          <p id="delivery" style="color: red;"></p>
          <button type="submit" class="btn btn-primary w-100">Track</button>
        </form>
      </div>
    </div>
  </div>
</div>



<div class="offcanvas offcanvas-end" tabindex="-1" id="cartOffcanvas">
  <div id="quick-cart-page">
  {% include "furni/quick-cart.html" with cart_items=cart_items %}
</div>
</div>

<script>
  function productSearch() {
      const searchform = document.getElementById("product-search");
      const searchword = document.getElementById("product-search-input");
      let word = searchword.value;
      searchform.setAttribute("action",`shop/search/${encodeURIComponent(word)}/`);
    }

document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById('trackOrderForm');
    form.addEventListener('submit', function (event) {
        event.preventDefault();
        const orderNo = document.getElementById('orderNo').value;
        const email = document.getElementById('emailid').value;
		const url = `/view_single_order/${orderNo}/${encodeURIComponent(email)}`;
        fetch(url, { method: "GET" })
            .then(response => {
                if (response.ok) {
                    window.location.href = url;
                } else {
                    document.getElementById('delivery').innerText = "The order does not exist";
                }
            })
            .catch(error => {
                document.getElementById('delivery').innerText = "An error occurred";
                console.error(error);
            });
    });
});

  function updateQuantity(button, change, item_id) {
    const input = button.parentElement.querySelector('input');
    let current = parseInt(input.value, 10);
    current += change;
    if (current < 1) current = 1; // Prevent going below 1
    input.value = current;
    cartUpdate(current, item_id)
  }
  function cartUpdate(quantity,item_id){
    const url = `/update/${item_id}/${quantity}/`
    fetch(url, {
      headers: { "X-Requested-With": "XMLHttpRequest",
      "X-Template-Type": "quick-cart"
      }
    })
      .then(response => response.text())
      .then(html => {
        document.getElementById("quick-cart-page").innerHTML = html;
      })
  }
  function deleteCartItem(item_id) {
    const url = `/remove/${item_id}/`
    fetch(url, {
      headers: { "X-Requested-With": "XMLHttpRequest",
      "X-Template-Type": "quick-cart"
      }
    })
      .then(response => response.text())
      .then(html => {
        document.getElementById("quick-cart-page").innerHTML = html;
      })
  }
</script>

		<!-- End Header/Navigation -->